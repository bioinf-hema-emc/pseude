getwd()
setwd('git_projects/pseude')
library(DESeq2)
load('data/GSE124872_raw_counts_single_cell.RData')
load('data/test_agglink.rda')
load_all()
library(devtools)
load_all()
getwd()
load_all()
load_all()
agg_counts <- scaggregate(raw_counts, agg_dt)
agg_counts
str(agg_counts)
agg_dt
annot_table <- unique(agg_dt[order(sample_name)])
annot_table
agg_tell <- 1
if (class(agg_tell) == "character") {
annot_cols <- colnames(agg_dt)[colnames(agg_dt) != agg_tell]
} else {
annot_cols <- colnames(agg_dt)[-agg_tell]
}
annot_table <- unique(agg_dt[order(sample_name), ..annot_cols])
annot_table
a
design <- as.formula("~state")
dds <- DESeqDataSetFromMatrix(agg_counts, colData = annotation_table, design = design)
dds <- DESeqDataSetFromMatrix(agg_counts, colData = annot_table, design = design)
dds
colData(dds)
colData(dds)$state
colData(dds)[, "state"]
is.element(colData(dds)[, "state"], c("old", "young"))
?split
?strsplit
dds
design(dds)
as.character(design(dds))
as.character(design(dds))[2]
?DESeq2::fpm
?dds
document()
document()
load_all()
dds
scout(dds)
?colData
annot_table
annot_table[, "state"]
annot_table[, state]
annot_table[, "state"] == "old"
c(annot_table[, "state"] == "old")
data.frame(annot_table)
tannot_table <- data.frame(annot_table)
c(tannot_table[, "state"] == "old")
tannot_table[, "state"] == "old"
identical(c(tannot_table[, "state"] == "old"), tannot_table[, "state"] == "old")
document()
load_all()
scout(dds, annot_table)
scout(dds, tannot_table)
rm(tannot_table)
dds
?DESeq
?DESeq2::lfcShrink
?DESeq2::rlog
document()
load_all()
document()
load_all()
dds <- scdeseq(agg_counts, annot_table)
dds
metadata(dds)
results(dds)
usethis::use_package("openxlsx")
res <- DESeq2::lfcShrink(dds, contrast = spl_com, type = "ashr", quiet = TRUE)
res <- DESeq2::lfcShrink(dds, contrast = strsplit("state,young,old")[[1]], type = "ashr", quiet = TRUE)
res <- DESeq2::lfcShrink(dds, contrast = strsplit("state,young,old", split = ",")[[1]], type = "ashr", quiet = TRUE)
res
norm_counts <- DESeq2::counts(dds, normalized = TRUE)
norm_counts
# Compute normalized counts
norm_counts <- data.table(DESeq2::counts(dds, normalized = TRUE))
# Compute normalized counts
norm_counts <- data.table::data.table(DESeq2::counts(dds, normalized = TRUE))
norm_counts
res
as.data.table(res)
data.table::as.data.table(res)
?data.table::as.data.table()
data.table::setDT(res)
tnorm_counts <- data.table::as.data.table(DESeq2::counts(dds, normalized = TRUE))
tnorm_counts
norm_counts
identical(norm_counts, tnorm_counts)
data.table::as.data.table(res)
data.table::as.data.table(res, keep.rownames = TRUE)
suppressWarnings(data.table::as.data.table(res, keep.rownames = TRUE))
# Compute normalized counts
norm_counts <- asdt(DESeq2::counts(dds, normalized = TRUE))
tnorm_counts <- data.table::as.data.table(DESeq2::counts(dds, normalized = TRUE))
tnorm_counts
res
tres <- suppressWarnings(data.table::as.data.table(res, keep.rownames = TRUE))
tres
out_res <- cbind(tres, tnorm_counts)
out_res
data.table::setnames(out_res, 'gene')
colnames(out_res)
data.table::setorder(out_res, padj)
out_res
res
na.omit(res)
out_sign <- out_res[padj < 0.05, ]
out_sing
out_sign
out_sign <- na.omit(out_res[padj < 0.05, ])
out_sign
?openxlsx::addWorksheet
?openxlsx::writeDataTable
?openxlsx::createWorkbook
openxlsx::createStyle
?openxlsx::createStyle
out_res
out_res[, rn:padj]
document()
load_all()
scout(dds)
res <- DESeq2::lfcShrink(dds, contrast = strsplit("state,young,old", split = ",")[[1]], type = "ashr", quiet = TRUE)
res
res <- data.table::as.data.table(DESeq2::lfcShrink(dds, contrast = strsplit("state,young,old", split = ",")[[1]], type = "ashr", quiet = TRUE))
res
res <- data.table::as.data.table(DESeq2::lfcShrink(dds, contrast = strsplit("state,young,old", split = ",")[[1]], type = "ashr", quiet = TRUE), keep.rownames = TRUE)
res
dim(res)
asdt <- function(x, keep.rownames = FALSE, ...) {
data.table::as.data.table(x, keep.rownames = FALSE, ...)
}
# Compute normalized counts
norm_counts <- asdt(DESeq2::counts(dds, normalized = TRUE))
norm_counts
dim(norm_counts)
rownames(dds)
document()
load_all()
scout(dds)
document()
load_all()
scout(dds)
out_res
out_res[, 1:6]
document()
load_all()
scout(dds)
xlsx_style <- openxlsx::createStyle(numFmt = "SCIENTIFIC",
borderColour = "#4F80BD",
borderStyle = "medium")
xlsx_style
document()
load_all()
scout(dds)
out_res["padj" < 0.05]
out_res[padj < 0.05]
out_res[("padj") < 0.05]
out_res[(c"padj") < 0.05]
out_res[c("padj") < 0.05]
out_res[out_res$padj < 0.05]
find("na.omit")
document()
load_all()
scout(dds)
use_package("DESeq2")
document()
load_all()
use_data(raw_counts)
agg_dt
raw_annotation <- agg_dt
use_data(raw_annotation)
raw_counts
raw_annotation
document()
load_all()
agg_counts
use_data(agg_counts)
annot_table
agg_table <- annot_table
use_data(agg_table)
dds
results(dds)
agg_dds <- dds
use_data(agg_data)
use_data(agg_dds)
agg_counts
colnames(agg_counts)
raw_table <- raw_annotation
use_data(raw_table)
agg_table
agg_dds
str(agg_dds)
slots(agg_dds)
slotNames(agg_dds)
document()
load_all()
?scaggregate
example_agg <- scaggregate(sc_counts = raw_counts,
sc_table = raw_table,
sc_group = "sample_name")
example_agg
test()
test()
check()
use_package("Matrix.utils")
document()
load_all()
check()
find("as.formula")
find("na.omit")
document()
document()
load_all()
document()
getwd()
document()
load_all()
library(devtools)
getwd()
document(
)
document()
load_all()
check()
library(ashr)
use_package(ashr)
use_package("ashr")
document()
load_all()
check()
?data.table::setorderv()
scout(agg_dds)
# Define variables
spl_com <- strsplit("state,young,old", split = ",")[[1]]
# Generate result table with ASHR-shrunk log2FC
res <- DESeq2::lfcShrink(agg_dds, contrast = spl_com, type = "ashr",
quiet = TRUE)
res
?as.data.frame
data.frame(res)
# Compute normalized counts
norm_counts <- data.frame(DESeq2::counts(agg_dds, normalized = TRUE))
res <- data.frame(res)
res
?data.frame
cbind(res, norm_counts)
out_res <- cbind(res, norm_counts)
# Clarify column content
colnames(out_res)[1:5] <- c("basemean", "l2fc_ASHR", "standerror_ASHR",
"pvalue", "padj")
out_res
# Reorder output table on adjusted p-value
out_res <- out_res[order(out_res$padj), c(4:5, 2:3, 1)]
out_res
out_res <- cbind(res, norm_counts)
out_res
colnames(out_res)[1:5] <- c("basemean", "l2fc_ASHR", "standerror_ASHR",
"pvalue", "padj")
# Reorder output table on adjusted p-value
out_res <- out_res[order(out_res$padj), c(4:5, 2:3, 1, 6:ncol(out_res))]
out_res
# Select significant genes
out_sign <- stats::na.omit(out_res[out_res$padj < 0.05, ])
out_sign
? openxlsx::writeDataTable
load("~/git_projects/pseude/data/raw_table.rda")
raw_table
data.frame(raw_table)
as.data.frame(raw_table)
raw_test <- data.frame(raw_table[, 2:3], row.names = raw_table[,1])
raw_test <- data.frame(raw_table[, 2:3], row.names = raw_table[,cell_name])
raw_test
str(raw_test)
raw_table <- raw_test
use_data(raw_table)
use_data(raw_table, overwrite = TRUE)
load("~/git_projects/pseude/data/agg_table.rda")
agg_table
data.frame(agg_table)
data.frame(agg_table, row.names = agg_table[, sample_name])
agg_table <- data.frame(agg_table, row.names = agg_table[, sample_name])
str(agg_table)
use_data(agg_table, overwrite = TRUE)
document()
load_all()
check()
document()
load_all()
example_agg <- scagg(raw_counts, raw_table)
example_agg
scdeseq(example_agg, agg_table)
example_dds <- scdeseq(example_agg, agg_table)
scout(example_dds)
check()
document()
load_all()
check()
use_mit_license()
document()
load_all()
check()
list.files()
check()
??DESeq2::DESeq
register(MulticoreParam(threads))
?DESeq2::DESeq
use_package("BiocParallel")
document()
document()
load_all()
example_dds <- scdeseq(agg_counts = agg_counts, agg_table = agg_table)
check()
document()
load_all()
example_out <- scout(dds = agg_dds, comparison = "state,young,old", do_write = FALSE)
example_out
document()
load_all()
check()
use_readme_rmd()
?devtools::build_readme()
devtools::build_readme()
document()
devtools::build_readme()
document()
library(devtools)
history()
build_readme()
document()
load_all()
?DESeq2::plotPCA
vsd <- varianceStabilizingTransformation(agg_dds, blind = TRUE, fitType = "parametric")
vsd <- DESeq2::varianceStabilizingTransformation(agg_dds, blind = TRUE, fitType = "parametric")
DESeq2::plotPCA(vsd)
colData(agg_dds)
DESeq2::colData(agg_dds)
find("colData")
?find
SummarizedExperiment::colData(agg_dds)
vsd <- DESeq2::varianceStabilizingTransformation(agg_dds, blind = TRUE, intgroup = "state", fitType = "parametric")
DESeq2::plotPCA(vsd, intgroup = "state")
?title
DESeq2::plotPCA(vsd, intgroup = "state") + title(main = "testing")
DESeq2::plotPCA(vsd, intgroup = "state") + ggplot2::ggtitle(main = "testing")
DESeq2::plotPCA(vsd, intgroup = "state") + ggplot2::ggtitle("testing")
DESeq2::plotPCA(vsd, intgroup = "state") + ggplot2::ggtitle("testing") + ggrepel::geom_text_repel(ggplot2::aes(label = name))
DESeq2::plotPCA(vsd, intgroup = "state") + ggplot2::ggtitle("testing") + ggplot2::aes(label = name)
DESeq2::plotPCA(vsd, intgroup = "state") + ggplot2::ggtitle("testing") + ggrepel::geom_text_repel(ggplot2::aes(label = name))
DESeq2::plotPCA(vsd, intgroup = "state") +
ggplot2::ggtitle("testing") +
ggrepel::geom_text_repel(ggplot2::aes(label = name))
DESeq2::plotPCA(vsd, intgroup = "state")
DESeq2::plotPCA(vsd, intgroup = "state", returnData = TRUE)
test_plot <- DESeq2::plotPCA(vsd, intgroup = "state", returnData = TRUE)
test_plot
?ggplot::plot
plot(test_plot)
ggplot2:ggplot(test_plot)
ggplot2::ggplot(test_plot)
ggplot2::ggplot(test_plot aes(PC1, PC2, color=Group))
ggplot2::ggplot(test_plot, aes(PC1, PC2, color=Group))
ggplot2::ggplot(test_plot, ggplot2::aes(PC1, PC2, color=Group))
ggplot2::ggplot(test_plot, ggplot2::aes(PC1, PC2, color=group)
)
ggplot2::ggplot(test_plot, ggplot2::aes(PC1, PC2, color=state)
)
ggplot2::ggplot(test_plot, ggplot2::aes(PC1, PC2, color=state))
ggplot2::ggplot(test_plot, ggplot2::aes(PC1, PC2, color=state)) + ggplot2::geom_point(size = 3)
ggplot2::ggplot(test_plot, ggplot2::aes(PC1, PC2, color=state)) + ggplot2::geom_point(size = 3) + ggplot2::coord_fixed()
ggplot2::ggplot(test_plot, ggplot2::aes(PC1, PC2, color=state)) + ggplot2::geom_point(size = 3)
ggplot2::ggplot(test_plot, ggplot2::aes(PC1, PC2, color=state)) + ggplot2::geom_point(size = 3) + ggplot2::coord_fixed()
ggplot2::ggplot(test_plot, ggplot2::aes(PC1, PC2, color=state)) + ggplot2::geom_point(size = 3)
ggplot2::ggplot(test_plot, ggplot2::aes(PC1, PC2, color=state)) + ggplot2::geom_point(size = 3) + ggplot2::coord_fixed()
document()
document()
document()
load_all()
test_schow(agg_dds, "state,young,old")
test_schow <- schow(agg_dds, "state,young,old")
test_schow()
test_schow
document()
load_all()
sctest <- schow(agg_dds, comparison = "state,young,old")
sctest
document()
load_all()
sctest <- schow(agg_dds, comparison = "state,young,old")
sctest
document()
load_all()
sctest <- schow(agg_dds, comparison = "state,young,old")
document(); load_all()
document(); load_all(); sctest <- schow(agg_dds, comparison = "state,young,old")
sctest
document(); load_all(); sctest <- schow(agg_dds, comparison = "state,young,old", do_write = TRUE)
document(); load_all(); sctest <- schow(agg_dds, comparison = "state,young,old", do_write = TRUE)
?ggplot2::aes
document(); load_all(); sctest <- schow(agg_dds, comparison = "state,young,old", do_write = TRUE)
sctest
DESeq2::plotPCA(vsd, intgroup = "state") +
ggplot2::ggtitle("testing") +
ggrepel::geom_text_repel(ggplot2::aes(label = name))
# PCA plots ---------------------------
test_sc <- DESeq2::plotPCA(vsd, intgroup = "state", returnData = TRUE)
test_sc
ggplot2::ggplot(test_sc, ggplot2::aes(PC1, PC2, colour = "state")) +
ggplot2::geom_point(size = 3) +
ggplot2::coord_fixed()
ggplot2::ggplot(test_sc, ggplot2::aes(PC1, PC2, colour = group)) +
ggplot2::geom_point(size = 3) +
ggplot2::coord_fixed()
document(); load_all(); sctest <- schow(agg_dds, comparison = "state,young,old", do_write = TRUE)
?attr
?percentVar
test_sc
percentVar <- round(100 * attr(test_sc, "percentVar"))
percentVar
str(test_sc)
?xlab
document(); sctest <- schow(agg_dds, comparison = "state,young,old", do_write = TRUE)
document(); sctest <- schow(agg_dds, comparison = "state,young,old", do_write = TRUE)
document(); sctest <- schow(agg_dds, comparison = "state,young,old", do_write = TRUE)
sctest
names(sctest)
scn <- names(sctest)
lapply(scn, function(x) {print(sctest[[x]])})
lapply(scn, function(x) {sctest[[x]]})
lapply(scn, function(x) {new_test <- sctest[[x]]; round(100 * attr(new_test, "percentVar"))})
lapply(scn, function(x) {new_test <- sctest[[x]]; round(100 * attr(new_test, "percentVar"))[2]})
document(); sctest <- schow(agg_dds, comparison = "state,young,old", do_write = TRUE)
?use_package()
use_package("ggplot2", type = "Suggests")
use_package("ggrepel", type = "Suggests")
document(); sctest <- schow(agg_dds, comparison = "state,young,old", do_write = TRUE)
document(); sctest <- schow(agg_dds, comparison = "state,young,old", do_write = TRUE)
document(); sctest <- schow(agg_dds, comparison = "state,young,old", do_write = TRUE)
document(); sctest <- schow(agg_dds, comparison = "state,young,old", do_write = TRUE)
?DESeq2::plotMA
scres <- data.frame(DESeq2::lfcShrink(agg_dds, contrast = spl_com, type = "ashr",
quiet = TRUE))
spl_com <- strsplit("state,young,old", split = ",")[[1]]
scres <- data.frame(DESeq2::lfcShrink(agg_dds, contrast = spl_com, type = "ashr",
quiet = TRUE))
# Get MA values ---------------------------
DESeq2::plotMA(scres)
scres
res <- DESeq2::lfcShrink(agg_dds, contrast = spl_com, type = "ashr", quiet = TRUE)
# Get MA values ---------------------------
DESeq2::plotMA(scres)
# Get MA values ---------------------------
DESeq2::plotMA(res)
# Get MA values ---------------------------
DESeq2::plotMA(res, ylim = c(-4, 4))
# Get MA values ---------------------------
DESeq2::plotMA(res, ylim = c(-4, 4), returnData = TRUE)
?DESeq2::plotMA
# Get MA values ---------------------------
scma <- DESeq2::plotMA(res, ylim = c(-4, 4), returnData = TRUE)
str(scma)
# Get MA values ---------------------------
scma <- DESeq2::plotMA(res, returnData = TRUE)
str(scma)
document(); sctest <- schow(agg_dds, comparison = "state,young,old", do_write = TRUE)
sctest
# Get MA values ---------------------------
ma_res <- DESeq2::plotMA(res, returnData = TRUE)
test_sc
dds <- agg_dds
rld <- DESeq2::rlog(dds, blind = FALSE)
rlb <- DESeq2::rlog(dds)
vsd <- DESeq2::varianceStabilizingTransformation(dds, blind = FALSE)
vsb <- DESeq2::varianceStabilizingTransformation(dds)
trans_list <- list(rlog = rld,
rlog_b = rlb,
varstab = vsd,
varstab_b = vsb)
trans_list <- trans_list[!sapply(trans_list, is.null)]
# Get PCA values ---------------------------
pca_list <- lapply(trans_list, DESeq2::plotPCA, intgroup = spl_com[1], returnData = TRUE)
pca_list
all_list <- c(pca_list, ma_res)
str(all_list)
all_list <- list(pca_list, ma_res)
str(all_list)
# Get MA values ---------------------------
ma_res <- list(DESeq2::plotMA(res, returnData = TRUE))
ma_res
all_list <- c(pca_list, ma_res)
str(all_list)
# Get MA values ---------------------------
ma_res <- list(res_MA = DESeq2::plotMA(res, returnData = TRUE))
all_list <- c(pca_list, ma_res)
str(all_list)
?densCols
res
document(); sctest <- schow(agg_dds, comparison = "state,young,old", do_write = TRUE)
